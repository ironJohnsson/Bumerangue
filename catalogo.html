<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Cat√°logo - Bumerangue</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root{--verde:#2e8b57;--verde-esc:#256b46;--fundo:#fffaf0;--card:#f8f8f8}
  *{box-sizing:border-box}
  body{font-family:"Roboto",sans-serif;background:var(--fundo);color:#333;margin:0}
  header,footer{background:var(--verde);color:#fff;padding:15px;text-align:center}
  nav a{margin:0 15px;color:#fff;text-decoration:none;font-weight:700}
  nav a:hover, nav a.active{color:#ffeb3b}
  .catalogo{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;padding:30px}
  .produto{background:var(--card);border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,.1);overflow:hidden;text-align:center;transition:transform .18s;cursor:pointer}
  .produto:hover{transform:scale(1.03)}
  .produto img{width:100%;height:200px;object-fit:cover}
  .produto h3{color:var(--verde);margin:10px 0}
  .produto p{padding:0 10px 15px;color:#666}
  button{background:var(--verde);color:#fff;border:none;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:700;margin:10px}
  button:hover{background:var(--verde-esc)}
  button.small{padding:6px 8px;font-size:.9rem;border-radius:6px}
  button.danger{background:#e04b4b}
  .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:32px;background:#111;color:#fff;padding:12px 18px;border-radius:10px;box-shadow:0 6px 20px rgba(0,0,0,.3);z-index:1200;opacity:0;pointer-events:none;transition:opacity .2s,transform .2s}
  .toast.show{opacity:1;transform:translateX(-50%) translateY(-6px);pointer-events:auto}
  #carrinhoBtn{position:fixed;right:20px;bottom:20px;background:var(--verde);color:#fff;border-radius:50%;width:60px;height:60px;border:none;font-size:22px;box-shadow:0 8px 20px rgba(0,0,0,.25);cursor:pointer}
  .subcats{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-bottom:16px}
  .subcat-btn{padding:8px 10px;border-radius:8px;border:2px solid var(--verde);background:#fff;color:var(--verde);cursor:pointer;font-weight:700}
  .subcat-btn.active{background:var(--verde);color:#fff}
  .catalogo-empty{text-align:center;padding:40px;color:#666}
  .modal{display:none;position:fixed;z-index:1100;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,.45);align-items:center;justify-content:center;padding:20px}
  .modal.show{display:flex}
  .modal-card{background:#fff;border-radius:12px;padding:20px;max-width:520px;width:100%;box-shadow:0 12px 30px rgba(0,0,0,.25);position:relative}
  .close{position:absolute;right:14px;top:10px;font-size:20px;color:var(--verde);cursor:pointer;font-weight:700}
  .close:hover{color:var(--verde-esc)}
</style>
</head>
<body>
<header>
  <h1>Cat√°logo Bumerangue</h1>
  <nav>
    <a href="index.html">In√≠cio</a>
    <a href="catalogo.html" class="active">Cat√°logo</a>
    <a href="sobre.html">Sobre</a>
    <a href="contato.html">Contato</a>
  </nav>
</header>

<main>
  <h2 style="text-align:center;margin:20px 0;color:var(--verde)">Nossas Bebidas e Produtos</h2>
  <div id="subcatsContainer" class="subcats"></div>
  <div class="catalogo" id="catalogo"></div>
</main>

<footer>
  <p>&copy; 2025 Bumerangue - Bebidas Artesanais</p>
</footer>

<!-- Modal produto -->
<div id="produtoModal" class="modal">
  <div class="modal-card">
    <span class="close" id="closeProduto">&times;</span>
    <h2 id="modalNome">Produto</h2>
    <p id="modalDescricao" style="color:#666;"></p>
    <div id="modalTamanhos"></div>
  </div>
</div>

<!-- Modal carrinho -->
<div id="carrinhoModal" class="modal">
  <div class="modal-card">
    <span class="close" id="closeCarrinho">&times;</span>
    <h2>Seu Carrinho</h2>
    <div id="itensCarrinho"></div>
    <p id="totalCarrinho" style="font-weight:700;margin-top:10px"></p>
    <label>Seu e-mail:</label>
    <input id="emailCliente" type="email" placeholder="seu@email.com" style="width:100%;padding:8px;border-radius:6px;border:1px solid #ccc">
    <div style="margin-top:10px;display:flex;gap:10px">
      <button id="finalizarPedido" style="flex:1">Finalizar Pedido</button>
      <button id="limparCarrinho" class="small danger" style="flex:1">Limpar</button>
    </div>
  </div>
</div>

<button id="carrinhoBtn">üõí</button>
<div id="toast" class="toast"></div>

<script>
const SHEET_ID = "19c63mlSybEumd2qgRciqTOzuXtCs_5eYEa5jXTylKyQ";
const SUBS_BY_CAT = {
  "Bebidas": ["Releitura dos Cl√°ssicos","Frutas","Sabores Brasileiros"],
  "Doces": ["Doces"],
  "Sabonetes": ["Sabonetes"]
};
const PRECO_POR_TAMANHO = { "280ml":30, "500ml":55, "750ml":80, "1L":100 };
const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwIjG3LEZt_xi0U8Wj0x0C_H-8rkb92nIkXA6uNpBiydGj-aQ4ro4N9BTtQfW42Czi_Ng/exec";

let produtosAtuais = [];
let carrinho = JSON.parse(localStorage.getItem("carrinhoBumerangue")) || [];

const catalogoDiv = document.getElementById('catalogo');
const subcatsContainer = document.getElementById('subcatsContainer');
const toastEl = document.getElementById('toast');
const produtoModal = document.getElementById('produtoModal');
const modalNome = document.getElementById('modalNome');
const modalDescricao = document.getElementById('modalDescricao');
const modalTamanhos = document.getElementById('modalTamanhos');
const carrinhoModal = document.getElementById('carrinhoModal');
const itensCarrinhoDiv = document.getElementById('itensCarrinho');
const totalCarrinhoP = document.getElementById('totalCarrinho');
const emailClienteInput = document.getElementById('emailCliente');

function showToast(msg,t=2500){toastEl.textContent=msg;toastEl.classList.add('show');clearTimeout(window._toastTimer);window._toastTimer=setTimeout(()=>toastEl.classList.remove('show'),t);}
function salvarCarrinho(){localStorage.setItem('carrinhoBumerangue',JSON.stringify(carrinho));}

function renderSubcats(){
  subcatsContainer.innerHTML='';
  SUBS_BY_CAT["Bebidas"].forEach((sub,idx)=>{
    const b=document.createElement('button');
    b.className='subcat-btn';
    b.textContent=sub;
    b.addEventListener('click',()=>{
      document.querySelectorAll('.subcat-btn').forEach(x=>x.classList.remove('active'));
      b.classList.add('active');
      carregarAba(sub);
    });
    subcatsContainer.appendChild(b);
    if(idx===0)b.click();
  });
}

async function carregarAba(sheetName){
  catalogoDiv.innerHTML=`<div class="catalogo-empty">‚è≥ Carregando ${sheetName}...</div>`;
  const url=`https://opensheet.elk.sh/${SHEET_ID}/${encodeURIComponent(sheetName)}`;
  try{
    const resp=await fetch(url);
    const dados=await resp.json();
    produtosAtuais=dados.map(d=>({nome:d.Nome||d.nome,descricao:d.Descricao||'',imagem:d.Imagem||'',...d}));
    renderCatalogo();
  }catch(e){catalogoDiv.innerHTML=`<div class="catalogo-empty">Erro ao carregar ${sheetName}</div>`;}
}

function renderCatalogo(){
  catalogoDiv.innerHTML='';
  produtosAtuais.forEach((p,i)=>{
    const el=document.createElement('div');
    el.className='produto';
    el.innerHTML=`<img src="${p.Imagem||'https://via.placeholder.com/400x200?text=Sem+imagem'}"><h3>${p.Nome||'Sem nome'}</h3><p>${p.Descricao||''}</p>`;
    const btn=document.createElement('button');
    btn.textContent='Ver tamanhos';
    btn.onclick=()=>abrirModal(p);
    el.appendChild(btn);
    catalogoDiv.appendChild(el);
  });
}

function abrirModal(produto){
  modalNome.textContent=produto.Nome;
  modalDescricao.textContent=produto.Descricao||'';
  modalTamanhos.innerHTML='';
  ["280ml","500ml","750ml","1L"].forEach(t=>{
    const btn=document.createElement('button');
    btn.textContent=`${t} - R$ ${PRECO_POR_TAMANHO[t]}`;
    btn.onclick=()=>{
      carrinho.push({nome:produto.Nome,tamanho:t,preco:PRECO_POR_TAMANHO[t]});
      salvarCarrinho();
      produtoModal.classList.remove('show');
      showToast('Adicionado ao carrinho!');
    };
    modalTamanhos.appendChild(btn);
  });
  produtoModal.classList.add('show');
}

document.getElementById('closeProduto').onclick=()=>produtoModal.classList.remove('show');
document.getElementById('closeCarrinho').onclick=()=>carrinhoModal.classList.remove('show');
document.getElementById('carrinhoBtn').onclick=abrirCarrinho;

function abrirCarrinho(){
  itensCarrinhoDiv.innerHTML='';
  if(!carrinho.length){itensCarrinhoDiv.innerHTML='<p class="small-muted">Carrinho vazio.</p>';totalCarrinhoP.textContent='';carrinhoModal.classList.add('show');return;}
  let total=0;
  carrinho.forEach((c,i)=>{total+=c.preco;const pElem=document.createElement('p');pElem.innerHTML=`${c.nome} (${c.tamanho}) - R$ ${c.preco} <button class='small danger' onclick='removerItem(${i})'>X</button>`;itensCarrinhoDiv.appendChild(pElem);});
  totalCarrinhoP.textContent=`Total: R$ ${total}`;
  carrinhoModal.classList.add('show');
}
function removerItem(i){carrinho.splice(i,1);salvarCarrinho();abrirCarrinho();}
document.getElementById('limparCarrinho').onclick=()=>{if(confirm('Limpar carrinho?')){carrinho=[];salvarCarrinho();abrirCarrinho();}};
document.getElementById('finalizarPedido').onclick=async()=>{
  const email=emailClienteInput.value.trim();
  if(!email){showToast('Informe seu e-mail');return;}
  if(!carrinho.length){showToast('Carrinho vazio');return;}
  const payload=carrinho.map(c=>({nome:c.nome,tamanho:c.tamanho,preco:c.preco}));
  payload[0].email=email;
  await fetch(APPS_SCRIPT_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
  showToast('Pedido enviado!');
  carrinho=[];salvarCarrinho();abrirCarrinho();
};

renderSubcats();
</script>
</body>
</html>
