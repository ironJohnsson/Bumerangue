<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Cat√°logo - Bumerangue</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root{--verde:#2e8b57;--verde-esc:#256b46;--fundo:#fffaf0;--card:#f8f8f8}
  *{box-sizing:border-box}
  body{font-family:"Roboto",sans-serif;background:var(--fundo);color:#333;margin:0}
  header,footer{background:var(--verde);color:#fff;padding:15px;text-align:center}
  nav a{margin:0 15px;color:#fff;text-decoration:none;font-weight:700;cursor:pointer}
  nav a:hover, nav a.active{color:#ffeb3b}
  .catalogo{display:grid;grid-template-columns:repeat(3,1fr);gap:20px;padding:30px}
  @media(max-width:900px){.catalogo{grid-template-columns:repeat(2,1fr)}}
  @media(max-width:600px){.catalogo{grid-template-columns:1fr}}
  .produto{background:var(--card);border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,.1);overflow:hidden;text-align:center;transition:transform .18s;cursor:pointer}
  .produto:hover{transform:scale(1.03)}
  .produto img{width:100%;height:200px;object-fit:cover}
  .produto h3{color:var(--verde);margin:10px 0}
  .produto p{padding:0 10px 15px;color:#666}
  #tabelaPrecos{max-width:600px;margin:30px auto;background:var(--card);border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,.1);padding:15px}
  #tabelaPrecos h3{color:var(--verde);text-align:center;margin-bottom:10px}
  .modal{display:none;position:fixed;z-index:1100;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,.45);align-items:center;justify-content:center;padding:20px}
  .modal.show{display:flex}
  .modal-card{background:#fff;border-radius:12px;padding:20px;max-width:520px;width:100%;box-shadow:0 12px 30px rgba(0,0,0,.25);position:relative}
  .modal-sm{max-width:420px}
  .close{position:absolute;right:14px;top:10px;font-size:20px;color:var(--verde);cursor:pointer;font-weight:700}
  .close:hover{color:var(--verde-esc)}
  table{width:100%;border-collapse:collapse;margin-top:10px}
  th,td{padding:8px;text-align:center;border-bottom:1px solid #eee;vertical-align:middle}
  th{background:var(--verde);color:#fff}
  .status-indisponivel{color:red;font-weight:700}
  .status-disponivel{color:green;font-weight:700}
  button{background:var(--verde);color:#fff;border:none;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:700}
  button.ghost{background:transparent;color:var(--verde);border:2px solid var(--verde)}
  button.small{padding:6px 8px;font-size:.9rem;border-radius:6px}
  button.danger{background:#e04b4b}
  .flex{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .right{display:flex;justify-content:flex-end}
  #carrinhoBtn{position:fixed;right:20px;bottom:20px;background:var(--verde);color:#fff;border-radius:50%;width:60px;height:60px;border:none;font-size:22px;box-shadow:0 8px 20px rgba(0,0,0,.25);cursor:pointer}
  .sizes{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:10px}
  .size-btn{padding:10px 14px;border-radius:10px;border:2px solid rgba(0,0,0,.06);cursor:pointer;background:#fff;font-weight:700;color:#000;transition:all .2s ease}
  .size-btn:hover:not(:disabled):not(.selected){background:#f0f0f0}
  .size-btn.selected{background:var(--verde);color:#fff;border-color:var(--verde)}
  .size-btn.selected:hover{background:#3fa76a}
  .size-btn:disabled{opacity:0.5;cursor:not-allowed;color:#666}
  .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:32px;background:#111;color:#fff;padding:12px 18px;border-radius:10px;box-shadow:0 6px 20px rgba(0,0,0,.3);z-index:1200;opacity:0;pointer-events:none;transition:opacity .2s,transform .2s}
  .toast.show{opacity:1;transform:translateX(-50%) translateY(-6px);pointer-events:auto}
  #itensCarrinho p{margin:8px 0;padding:8px;border-radius:8px;background:#fafafa;border:1px solid #eee;display:flex;justify-content:space-between;align-items:center}
  #itensCarrinho .item-left{display:flex;flex-direction:column;align-items:flex-start;gap:4px}
  .small-muted{font-size:.9rem;color:#666}
  .subcats{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-bottom:16px}
  .subcat-btn{padding:8px 10px;border-radius:8px;border:2px solid var(--verde);background:#fff;color:var(--verde);cursor:pointer;font-weight:700}
  .subcat-btn.active{background:var(--verde);color:#fff}
  .catalogo-empty{text-align:center;padding:40px;color:#666}
</style>
</head>
<body>
<header>
  <h1>Cat√°logo Bumerangue</h1>
  <nav>
    <a href="index.html">In√≠cio</a>
    <a href="catalogo.html" class="active">Cat√°logo</a>
    <a href="sobre.html">Sobre</a>
    <a href="contato.html">Contato</a>
  </nav>
</header>

<main>
  <h2 style="text-align:center;margin:20px 0;color:var(--verde)">Nossas Bebidas e Produtos</h2>

  <div id="tabelaPrecos">
    <h3>Tabela de Pre√ßos (padr√£o para todos os sabores)</h3>
    <table>
      <thead><tr><th>Tamanho</th><th>Pre√ßo</th></tr></thead>
      <tbody>
        <tr><td>280ml</td><td>R$ 30,00</td></tr>
        <tr><td>500ml</td><td>R$ 55,00</td></tr>
        <tr><td>750ml</td><td>R$ 80,00</td></tr>
        <tr><td>1L</td><td>R$ 100,00</td></tr>
      </tbody>
    </table>
  </div>

  <div id="subcatsContainer" class="subcats"></div>
  <div class="catalogo" id="catalogo"></div>
</main>

<footer>
  <p>&copy; 2025 Bumerangue - Bebidas Artesanais</p>
</footer>

<!-- Modais -->
<div id="produtoModal" class="modal" aria-hidden="true">
  <div class="modal-card modal-sm" role="dialog" aria-modal="true">
    <span class="close" id="closeProduto">&times;</span>
    <h2 id="modalNome">Produto</h2>
    <table>
      <thead><tr><th>Tamanho</th><th>Qtde</th><th>A√ß√£o</th></tr></thead>
      <tbody id="modalTabela"></tbody>
    </table>
  </div>
</div>

<div id="sizeSelectModal" class="modal" aria-hidden="true">
  <div class="modal-card" role="dialog" aria-modal="true">
    <span class="close" id="closeSize">&times;</span>
    <h3 id="sizeTitle">Escolha o tamanho</h3>
    <p class="small-muted" id="sizeInfo">Selecione o tamanho da garrafa</p>
    <div class="sizes" id="sizeButtons">
      <button class="size-btn" data-size="280ml">280ml</button>
      <button class="size-btn" data-size="500ml">500ml</button>
      <button class="size-btn" data-size="750ml">750ml</button>
      <button class="size-btn" data-size="1L">1L</button>
    </div>
    <div style="margin-top:16px;display:flex;gap:8px;justify-content:center">
      <button id="confirmSize" class="small">Adicionar</button>
      <button id="cancelSize" class="ghost small">Cancelar</button>
    </div>
  </div>
</div>

<div id="carrinhoModal" class="modal" aria-hidden="true">
  <div class="modal-card" role="dialog" aria-modal="true">
    <span class="close" id="closeCarrinho">&times;</span>
    <h2>Seu Carrinho</h2>
    <div id="itensCarrinho"></div>
    <p id="totalCarrinho" style="font-weight:700;margin-top:10px"></p>
    <label style="display:block;margin-top:8px">Seu e-mail</label>
    <input id="emailCliente" type="email" placeholder="seu@email.com" style="width:100%;padding:8px;margin:6px 0;border-radius:6px;border:1px solid #ddd">
    <div style="display:flex;gap:8px;margin-top:10px">
      <button id="finalizarPedido" style="flex:1">Finalizar pedido (enviar)</button>
      <button id="limparCarrinho" class="ghost" style="flex:1">Limpar</button>
    </div>
    <div style="text-align:center;margin-top:12px">
      <p class="small-muted">QR Code para pagamento (valor total)</p>
      <img id="qrPreview" width="200" height="200" alt="QR Code" style="display:block;margin:0 auto">
    </div>
  </div>
</div>

<button id="carrinhoBtn" title="Ver carrinho">üõí</button>
<div id="toast" class="toast" role="status" aria-live="polite"></div>

<script>
const SHEET_ID = "19c63mlSybEumd2qgRciqTOzuXtCs_5eYEa5jXTylKyQ";
const SUBS_BY_CAT = {
  "Bebidas": ["Releitura dos Cl√°ssicos","Frutas","Sabores Brasileiros"],
  "Doces": ["Doces"],
  "Sabonetes": ["Sabonetes"]
};
const PRECO_POR_TAMANHO = { "280ml":30, "500ml":55, "750ml":80, "1L":100 };
const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwIjG3LEZt_xi0U8Wj0x0C_H-8rkb92nIkXA6uNpBiydGj-aQ4ro4N9BTtQfW42Czi_Ng/exec";

let produtosAtuais = [];
let carrinho = JSON.parse(localStorage.getItem("carrinhoBumerangue")) || [];
let sizeContext = null;

const catalogoDiv = document.getElementById('catalogo');
const subcatsContainer = document.getElementById('subcatsContainer');
const toastEl = document.getElementById('toast');
const produtoModal = document.getElementById('produtoModal');
const modalNome = document.getElementById('modalNome');
const modalTabela = document.getElementById('modalTabela');
const sizeModal = document.getElementById('sizeSelectModal');
const sizeTitle = document.getElementById('sizeTitle');
const sizeInfo = document.getElementById('sizeInfo');
const sizeButtons = document.getElementById('sizeButtons');
const confirmSizeBtn = document.getElementById('confirmSize');
const cancelSizeBtn = document.getElementById('cancelSize');
const carrinhoBtn = document.getElementById('carrinhoBtn');
const carrinhoModal = document.getElementById('carrinhoModal');
const itensCarrinhoDiv = document.getElementById('itensCarrinho');
const totalCarrinhoP = document.getElementById('totalCarrinho');
const emailClienteInput = document.getElementById('emailCliente');
const qrPreview = document.getElementById('qrPreview');

function showToast(msg, t=2500){ toastEl.textContent=msg;toastEl.classList.add('show');clearTimeout(window._toastTimer);window._toastTimer=setTimeout(()=>toastEl.classList.remove('show'),t); }
function salvarCarrinho(){ localStorage.setItem('carrinhoBumerangue', JSON.stringify(carrinho)); }

function renderCategoriaBtns(){
  subcatsContainer.innerHTML='';
  const firstCat=Object.keys(SUBS_BY_CAT)[0];
  Object.entries(SUBS_BY_CAT).forEach(([cat,subs])=>{
    const catBtn=document.createElement('button');
    catBtn.className='subcat-btn';
    catBtn.textContent=cat;
    catBtn.dataset.cat=cat;
    catBtn.addEventListener('click',()=>{
      document.querySelectorAll('.subcat-btn').forEach(b=>b.classList.remove('active'));
      catBtn.classList.add('active');
      renderSubcats(cat);
    });
    subcatsContainer.appendChild(catBtn);
    if(cat===firstCat)catBtn.click();
  });
}

function renderSubcats(cat){
  const subs=SUBS_BY_CAT[cat]||[];
  subcatsContainer.innerHTML='';
  subs.forEach((s,idx)=>{
    const b=document.createElement('button');
    b.className='subcat-btn';
    b.textContent=s;
    b.dataset.sheet=s;
    b.addEventListener('click',()=>{
      subcatsContainer.querySelectorAll('.subcat-btn').forEach(x=>x.classList.remove('active'));
      b.classList.add('active');
      carregarAba(s,cat);
    });
    subcatsContainer.appendChild(b);
    if(idx===0)b.click();
  });
}

async function carregarAba(sheetName,categoria){
  catalogoDiv.innerHTML=`<div class="catalogo-empty">‚è≥ Carregando ${sheetName}...</div>`;
  const url=`https://opensheet.elk.sh/${SHEET_ID}/${encodeURIComponent(sheetName)}`;
  try{
    const resp=await fetch(url);
    if(!resp.ok)throw new Error("Erro ao buscar planilha");
    const dados=await resp.json();
    produtosAtuais=dados.map(d=>normalizeRow(d));
    renderCatalogo(categoria,sheetName);
  }catch(err){
    console.error(err);
    catalogoDiv.innerHTML=`<div class="catalogo-empty">Erro ao carregar "${sheetName}".</div>`;
  }
}

function normalizeRow(d){
  const row={};
  Object.keys(d).forEach(k=>row[k.trim()]=d[k]);
  row.nome=row.nome||row.Nome||row.name||row['Produto']||'';
  row.descricao=row.descricao||row.Descricao||'';
  row.imagem=row.imagem||row.Imagem||'';
  const getNum=k=>parseFloat(String(row[k]||'').replace(',','.'))||0;
  row['280ml']=getNum('280ml');row['500ml']=getNum('500ml');row['750ml']=getNum('750ml');row['1L']=getNum('1L');row['nao_engarrafado']=getNum('nao_engarrafado');
  row.preco=parseFloat(String(row.preco||0).replace(',','.'))||0;
  row.estoque=parseFloat(String(row.estoque||0).replace(',','.'))||0;
  return row;
}

function renderCatalogo(categoria,abaNome){
  catalogoDiv.innerHTML='';
  if(!produtosAtuais.length){catalogoDiv.innerHTML=`<div class="catalogo-empty">Nenhum produto encontrado.</div>`;return;}
  const bebidasTabs=SUBS_BY_CAT['Bebidas']||[];
  const isBebida=bebidasTabs.includes(abaNome);
  produtosAtuais.forEach((p,i)=>{
    const el=document.createElement('div');
    el.className='produto';
    el.innerHTML=`<img src="${p.imagem||'https://via.placeholder.com/400x200?text=Sem+imagem'}"><h3>${p.nome}</h3><p>${p.descricao||''}</p>`;
    if(isBebida){
      const table=document.createElement('table');
      table.innerHTML=`<thead><tr><th>Tamanho</th><th>Qtde</th></tr></thead><tbody>
      <tr><td>280ml</td><td>${p['280ml']||'-'}</td></tr>
      <tr><td>500ml</td><td>${p['500ml']||'-'}</td></tr>
      <tr><td>750ml</td><td>${p['750ml']||'-'}</td></tr>
      <tr><td>1L</td><td>${p['1L']||'-'}</td></tr>
      <tr><td>N√£o engarrafado</td><td>${p['nao_engarrafado']||'-'}</td></tr></tbody>`;
      el.appendChild(table);
      const todasZero=[p['280ml'],p['500ml'],p['750ml'],p['1L'],p['nao_engarrafado']].every(v=>!v||v===0);
      const btn=document.createElement('button');
      btn.textContent=todasZero?'Indispon√≠vel':'Ver tamanhos';
      if(todasZero)btn.disabled=true;
      btn.className='small';
      btn.style.margin='10px';
      btn.addEventListener('click',()=>abrirModalBebida(i));
      el.appendChild(btn);
    }else{
      const estoqueLabel=(p.estoque>0)?`<span class="status-disponivel">${p.estoque}</span>`:`<span class="status-indisponivel">Indispon√≠vel</span>`;
      const precoLabel=p.preco?`R$ ${p.preco}`:'‚Äî';
      el.innerHTML+=`<p><strong>Pre√ßo:</strong> ${precoLabel}</p><p><strong>Estoque:</strong> ${estoqueLabel}</p>`;
      const addBtn=document.createElement('button');
      addBtn.textContent=(p.estoque>0)?'Adicionar ao carrinho':'Indispon√≠vel';
      if(!(p.estoque>0))addBtn.disabled=true;
      addBtn.style.margin='10px';
      addBtn.addEventListener('click',()=>{
        p.estoque--;carrinho.push({nome:p.nome,tamanho:'√önico',preco:p.preco||0});
        salvarCarrinho();renderCatalogo(categoria,abaNome);showToast('Adicionado ao carrinho');
      });
      el.appendChild(addBtn);
    }
    catalogoDiv.appendChild(el);
  });
}

function abrirModalBebida(i){
  const p=produtosAtuais[i];
  modalNome.textContent=p.nome;
  modalTabela.innerHTML='';
  const sizes=["280ml","500ml","750ml","1L","N√£o engarrafado"];
  sizes.forEach(sz=>{
    const key=sz==="N√£o engarrafado"?'nao_engarrafado':sz;
    const q=p[key]||0;
    const disp=q>0;
    const statusClass=disp?'status-disponivel':'status-indisponivel';
    const btnHtml=disp?`<button class="small" onclick="iniciarAddBebida(${i},'${sz}')">Adicionar</button>`:'';
    modalTabela.insertAdjacentHTML('beforeend',`<tr><td>${sz}</td><td class="${statusClass}">${disp?q:'Indispon√≠vel'}</td><td>${btnHtml}</td></tr>`);
  });
  produtoModal.classList.add('show');
}

let selectedSize=null;
sizeButtons.querySelectorAll('.size-btn').forEach(btn=>{
  btn.addEventListener('click',()=>{
    sizeButtons.querySelectorAll('.size-btn').forEach(b=>b.classList.remove('selected'));
    btn.classList.add('selected');selectedSize=btn.dataset.size;
  });
});
document.getElementById('closeProduto').onclick=()=>produtoModal.classList.remove('show');
document.getElementById('closeSize').onclick=()=>sizeModal.classList.remove('show');
document.getElementById('closeCarrinho').onclick=()=>carrinhoModal.classList.remove('show');

function abrirCarrinho(){
  itensCarrinhoDiv.innerHTML='';
  if(!carrinho.length){itensCarrinhoDiv.innerHTML='<p class="small-muted">Seu carrinho est√° vazio.</p>';totalCarrinhoP.textContent='';qrPreview.style.display='none';carrinhoModal.classList.add('show');return;}
  let total=0;
  carrinho.forEach((c,i)=>{total+=Number(c.preco||0);const pElem=document.createElement('p');pElem.innerHTML=`<span class="item-left"><strong>${c.nome}</strong><span class="small-muted">${c.tamanho} ¬∑ R$ ${c.preco},00</span></span><span><button class="danger small" onclick="removerItem(${i})">Remover</button></span>`;itensCarrinhoDiv.appendChild(pElem);});
  totalCarrinhoP.textContent=`Total: R$ ${total},00`;
  qrPreview.src=`https://chart.googleapis.com/chart?chs=300x300&cht=qr&chl=${encodeURIComponent('Pix Bumerangue R$'+total)}`;
  qrPreview.style.display='block';carrinhoModal.classList.add('show');
}
function removerItem(i){carrinho.splice(i,1);salvarCarrinho();abrirCarrinho();showToast('Item removido');}
document.getElementById('limparCarrinho').onclick=()=>{if(confirm('Deseja esvaziar o carrinho?')){carrinho=[];salvarCarrinho();abrirCarrinho();showToast('Carrinho limpo');}};
document.getElementById('finalizarPedido').onclick=async()=>{const email=(emailClienteInput.value||'').trim();if(!email){showToast('Informe seu e-mail');return;}if(!carrinho.length){showToast('Carrinho vazio');return;}const payload=carrinho.map(c=>({nome:c.nome,tamanho:c.tamanho,preco:c.preco}));payload[0].email=email;await fetch(APPS_SCRIPT_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});showToast('Pedido enviado!');carrinho=[];salvarCarrinho();abrirCarrinho();};

carrinhoBtn.onclick=abrirCarrinho;
renderCategoriaBtns();
salvarCarrinho();
</script>
</body>
</html>
