<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Catálogo - Produtos Regionais</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #fff7ed;
    color: #4b3832;
    margin: 0;
    padding: 0;
  }
  h1 {
    text-align: center;
    background-color: #d4a373;
    color: white;
    padding: 20px 0;
    margin: 0;
  }
  #categorias, #subcategorias {
    text-align: center;
    margin: 20px;
  }
  button {
    background-color: #d4a373;
    color: white;
    border: none;
    padding: 10px 15px;
    margin: 5px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
  }
  button:hover {
    background-color: #b5835a;
  }
  .catalogo {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 15px;
    padding: 20px;
  }
  .produto {
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    text-align: center;
    padding: 10px;
    width: 200px;
    cursor: pointer;
    transition: transform 0.2s;
  }
  .produto:hover {
    transform: scale(1.05);
  }
  .produto img {
    width: 100%;
    border-radius: 10px;
    height: 180px;
    object-fit: cover;
  }
  /* Modal */
  .modal {
    display: none;
    position: fixed;
    z-index: 100;
    padding-top: 50px;
    left: 0; top: 0;
    width: 100%; height: 100%;
    background-color: rgba(0,0,0,0.6);
  }
  .modal-content {
    background-color: white;
    margin: auto;
    padding: 20px;
    border-radius: 12px;
    width: 90%;
    max-width: 600px;
  }
  .close {
    color: #888;
    float: right;
    font-size: 24px;
    font-weight: bold;
    cursor: pointer;
  }
  .close:hover { color: black; }
</style>
</head>
<body>

<h1>Catálogo de Produtos Regionais</h1>

<div id="categorias"></div>
<div id="subcategorias" style="display:none;"></div>

<div class="catalogo" id="catalogo"></div>

<!-- Modal -->
<div id="produtoModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="fecharModal()">&times;</span>
    <h2 id="modalNome"></h2>
    <img id="modalImagem" src="" alt="" style="width:100%;border-radius:10px;">
    <p id="modalDescricao"></p>
    <h3>Estoque disponível:</h3>
    <ul id="modalEstoque"></ul>
  </div>
</div>

<script>
const sheetId = "SEU_ID_AQUI"; // <-- substitua aqui
const sheetName = "Página1";
const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&tq&sheet=${sheetName}`;

let produtosBase = [];
let listaAtual = [];

async function carregarProdutos() {
  try {
    const res = await fetch(url);
    const text = await res.text();
    const json = JSON.parse(text.substr(47).slice(0, -2));
    const rows = json.table.rows.map(r => r.c.map(c => (c ? c.v : "")));

    produtosBase = rows.map(r => ({
      categoria: r[0],
      subcategoria: r[1],
      nome: r[2],
      descricao: r[3],
      imagem: r[4],
      estoque: {
        "280ml": Number(r[5]) || 0,
        "500ml": Number(r[6]) || 0,
        "750ml": Number(r[7]) || 0,
        "1L": Number(r[8]) || 0,
        "Não engarrafado": Number(r[9]) || 0
      }
    }));

    renderCategorias();
  } catch (e) {
    console.error("Erro ao carregar produtos:", e);
  }
}

function renderCategorias() {
  const catDiv = document.getElementById("categorias");
  const categorias = [...new Set(produtosBase.map(p => p.categoria))];
  catDiv.innerHTML = categorias.map(c =>
    `<button onclick="selecionarCategoria('${c}')">${c}</button>`
  ).join("");
}

function selecionarCategoria(categoria) {
  const subDiv = document.getElementById("subcategorias");
  const subcategorias = [...new Set(produtosBase
    .filter(p => p.categoria === categoria)
    .map(p => p.subcategoria)
    .filter(s => s))];

  subDiv.style.display = "block";
  subDiv.innerHTML = subcategorias.map(s =>
    `<button onclick="filtrarProdutos('${categoria}','${s}')">${s}</button>`
  ).join("");
}

function filtrarProdutos(categoria, subcategoria) {
  listaAtual = produtosBase.filter(
    p => p.categoria === categoria && p.subcategoria === subcategoria
  );
  renderCatalogo(listaAtual);
}

function renderCatalogo(lista) {
  const catalogoDiv = document.getElementById('catalogo');
  catalogoDiv.innerHTML = "";
  lista.forEach((p, i) => {
    const el = document.createElement('div');
    el.className = 'produto';
    el.innerHTML = `
      <img src="${p.imagem}" alt="${p.nome}">
      <h3>${p.nome}</h3>
      <p>${p.descricao}</p>`;
    el.addEventListener('click', () => abrirModal(i));
    catalogoDiv.appendChild(el);
  });
}

function abrirModal(index) {
  const produto = listaAtual[index];
  document.getElementById("modalNome").innerText = produto.nome;
  document.getElementById("modalDescricao").innerText = produto.descricao;
  document.getElementById("modalImagem").src = produto.imagem;
  const estoqueUl = document.getElementById("modalEstoque");
  estoqueUl.innerHTML = "";

  for (const [formato, valor] of Object.entries(produto.estoque)) {
    if (valor > 0) {
      const li = document.createElement("li");
      li.innerText = `${formato}: ${valor}`;
      estoqueUl.appendChild(li);
    }
  }

  document.getElementById("produtoModal").style.display = "block";
}

function fecharModal() {
  document.getElementById("produtoModal").style.display = "none";
}

window.onclick = function(event) {
  const modal = document.getElementById("produtoModal");
  if (event.target === modal) modal.style.display = "none";
}

carregarProdutos();
</script>

</body>
</html>
