<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Cat√°logo - Bumerangue</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root{--verde:#2e8b57;--verde-esc:#256b46;--fundo:#fffaf0;--card:#f8f8f8}
  *{box-sizing:border-box}
  body{font-family:"Roboto",sans-serif;background:var(--fundo);color:#333;margin:0}
  header,footer{background:var(--verde);color:#fff;padding:15px;text-align:center}
  nav a{margin:0 15px;color:#fff;text-decoration:none;font-weight:700}
  nav a:hover, nav a.active{color:#ffeb3b}
  main{padding:20px 12px 80px}
  .top-controls{display:flex;flex-direction:column;align-items:center;gap:12px;margin-bottom:18px}
  .cats{display:flex;gap:10px;flex-wrap:wrap;justify-content:center}
  .cat-btn{padding:10px 14px;border-radius:10px;border:2px solid var(--verde);background:#fff;color:var(--verde);cursor:pointer;font-weight:700}
  .cat-btn.active{background:var(--verde);color:#fff}
  .subcats{display:flex;gap:8px;flex-wrap:wrap;justify-content:center}
  .subcat-btn{padding:8px 10px;border-radius:8px;border:2px solid var(--verde);background:#fff;color:var(--verde);cursor:pointer;font-weight:700}
  .subcat-btn.active{background:var(--verde);color:#fff}
  .catalogo{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:20px;padding:10px 20px}
  .produto{background:var(--card);border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,.1);overflow:hidden;text-align:center;transition:transform .18s;cursor:default;padding-bottom:18px}
  .produto:hover{transform:scale(1.03)}
  .produto img{width:100%;height:180px;object-fit:cover}
  .produto h3{color:var(--verde);margin:12px 0 6px 0}
  .produto p{padding:0 12px 12px;color:#666;min-height:42px}
  button{background:var(--verde);color:#fff;border:none;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:700}
  button.small{padding:6px 8px;font-size:.9rem;border-radius:6px}
  button.danger{background:#e04b4b}
  table{border-collapse:collapse;width:100%;max-width:600px;margin:0 auto 20px;background:#fff;border-radius:10px;overflow:hidden;box-shadow:0 2px 6px rgba(0,0,0,.1)}
  th,td{border:1px solid #ccc;padding:8px;text-align:center}
  th{background:var(--verde);color:#fff}
  .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:32px;background:#111;color:#fff;padding:12px 18px;border-radius:10px;box-shadow:0 6px 20px rgba(0,0,0,.3);z-index:1200;opacity:0;pointer-events:none;transition:opacity .2s,transform .2s}
  .toast.show{opacity:1;transform:translateX(-50%) translateY(-6px);pointer-events:auto}
  #carrinhoBtn{position:fixed;right:20px;bottom:20px;background:var(--verde);color:#fff;border-radius:50%;width:60px;height:60px;border:none;font-size:22px;box-shadow:0 8px 20px rgba(0,0,0,.25);cursor:pointer}
  .catalogo-empty{text-align:center;padding:40px;color:#666}
  .modal{display:none;position:fixed;z-index:1100;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,.45);align-items:center;justify-content:center;padding:20px}
  .modal.show{display:flex}
  .modal-card{background:#fff;border-radius:12px;padding:20px;max-width:520px;width:100%;box-shadow:0 12px 30px rgba(0,0,0,.25);position:relative}
  .close{position:absolute;right:14px;top:10px;font-size:20px;color:var(--verde);cursor:pointer;font-weight:700}
  .close:hover{color:var(--verde-esc)}
  input[type="email"]{width:100%;padding:8px;border-radius:6px;border:1px solid #ddd}
  .status-ok{color:var(--verde);font-weight:700}
  .status-no{color:#e04b4b;font-weight:700}
</style>
</head>
<body>
<header>
  <h1>Cat√°logo Bumerangue</h1>
  <nav>
    <a href="index.html">In√≠cio</a>
    <a href="catalogo.html" class="active">Cat√°logo</a>
    <a href="sobre.html">Sobre</a>
    <a href="contato.html">Contato</a>
  </nav>
</header>

<main>
  <div class="top-controls">
    <h2 style="color:var(--verde);margin:0">Nossas Bebidas e Produtos</h2>
    <div class="cats" id="catsContainer"></div>
    <div id="subcatsWrapper" style="width:100%;display:flex;justify-content:center">
      <div class="subcats" id="subcatsContainer"></div>
    </div>
  </div>

  <!-- tabela fixa de pre√ßos -->
  <div id="priceTableContainer" style="display:none;">
    <table>
      <thead><tr><th>Tamanho</th><th>Pre√ßo</th></tr></thead>
      <tbody>
        <tr><td>280ml</td><td>R$ 30</td></tr>
        <tr><td>500ml</td><td>R$ 55</td></tr>
        <tr><td>750ml</td><td>R$ 80</td></tr>
        <tr><td>1L</td><td>R$ 100</td></tr>
      </tbody>
    </table>
  </div>

  <div id="catalogo" class="catalogo"></div>
</main>

<footer>
  <p>&copy; 2025 Bumerangue - Bebidas Artesanais</p>
</footer>

<!-- Modal produto -->
<div id="produtoModal" class="modal">
  <div class="modal-card">
    <span class="close" id="closeProduto">&times;</span>
    <h2 id="modalNome">Produto</h2>
    <p id="modalDescricao" style="color:#666;margin-bottom:10px;"></p>
    <table>
      <thead><tr><th>Tamanho</th><th>Disponibilidade</th><th>A√ß√£o</th></tr></thead>
      <tbody id="modalTabela"></tbody>
    </table>
  </div>
</div>

<!-- Modal carrinho -->
<div id="carrinhoModal" class="modal">
  <div class="modal-card">
    <span class="close" id="closeCarrinho">&times;</span>
    <h2>Seu Carrinho</h2>
    <div id="itensCarrinho" style="margin-top:10px"></div>
    <p id="totalCarrinho" style="font-weight:700;margin-top:10px"></p>
    <label style="display:block;margin-top:8px">Seu e-mail</label>
    <input id="emailCliente" type="email" placeholder="seu@email.com" style="margin-top:6px">
    <div style="display:flex;gap:8px;margin-top:12px">
      <button id="finalizarPedido" style="flex:1">Finalizar pedido</button>
      <button id="limparCarrinho" class="danger" style="flex:1">Limpar</button>
    </div>
  </div>
</div>

<button id="carrinhoBtn">üõí</button>
<div id="toast" class="toast"></div>

<script>
const SHEET_ID = "19c63mlSybEumd2qgRciqTOzuXtCs_5eYEa5jXTylKyQ";
const SUBS_BY_CAT = {
  "Bebidas": ["Releitura dos Cl√°ssicos","Frutas","Sabores Brasileiros"],
  "Doces": ["Doces"],
  "Sabonetes": ["Sabonetes"]
};
const PRECO_POR_TAMANHO = { "280ml":30, "500ml":55, "750ml":80, "1L":100 };
const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwIjG3LEZt_xi0U8Wj0x0C_H-8rkb92nIkXA6uNpBiydGj-aQ4ro4N9BTtQfW42Czi_Ng/exec";

let produtosAtuais = [];
let carrinho = JSON.parse(localStorage.getItem("carrinhoBumerangue")) || [];

const catsContainer = document.getElementById('catsContainer');
const subcatsContainer = document.getElementById('subcatsContainer');
const priceTableContainer = document.getElementById('priceTableContainer');
const catalogoDiv = document.getElementById('catalogo');
const produtoModal = document.getElementById('produtoModal');
const modalNome = document.getElementById('modalNome');
const modalDescricao = document.getElementById('modalDescricao');
const modalTabela = document.getElementById('modalTabela');
const toastEl = document.getElementById('toast');
const carrinhoModal = document.getElementById('carrinhoModal');
const itensCarrinhoDiv = document.getElementById('itensCarrinho');
const totalCarrinhoP = document.getElementById('totalCarrinho');
const emailClienteInput = document.getElementById('emailCliente');

function showToast(msg,t=2500){toastEl.textContent=msg;toastEl.classList.add('show');clearTimeout(window._toastTimer);window._toastTimer=setTimeout(()=>toastEl.classList.remove('show'),t);}
function salvarCarrinho(){localStorage.setItem('carrinhoBumerangue',JSON.stringify(carrinho));}

function renderCategorias(){
  catsContainer.innerHTML='';
  Object.keys(SUBS_BY_CAT).forEach((cat,idx)=>{
    const b=document.createElement('button');
    b.className='cat-btn';
    b.textContent=cat;
    b.onclick=()=>selecionarCategoria(cat,b);
    catsContainer.appendChild(b);
    if(idx===0)b.click();
  });
}

function selecionarCategoria(cat,btn){
  document.querySelectorAll('.cat-btn').forEach(x=>x.classList.remove('active'));
  btn.classList.add('active');
  const subs=SUBS_BY_CAT[cat]||[];
  subcatsContainer.innerHTML='';
  if(cat==="Bebidas"){priceTableContainer.style.display='block';}
  else{priceTableContainer.style.display='none';}
  if(subs.length){
    subs.forEach((s,i)=>{
      const sb=document.createElement('button');
      sb.className='subcat-btn';
      sb.textContent=s;
      sb.onclick=()=>selecionarSubcategoria(s,sb);
      subcatsContainer.appendChild(sb);
      if(i===0)sb.click();
    });
  }else carregarAba(cat);
}

function selecionarSubcategoria(sub,sb){
  document.querySelectorAll('.subcat-btn').forEach(x=>x.classList.remove('active'));
  sb.classList.add('active');
  carregarAba(sub);
}

async function carregarAba(sheetName){
  catalogoDiv.innerHTML='<div class="catalogo-empty">‚è≥ Carregando...</div>';
  try{
    const url=`https://opensheet.elk.sh/${SHEET_ID}/${encodeURIComponent(sheetName)}`;
    const resp=await fetch(url);
    const dados=await resp.json();
    produtosAtuais=dados.map(d=>({nome:d.Nome||d.nome,descricao:d.Descricao||d.descricao,imagem:d.Imagem||d.imagem,...d}));
    renderCatalogo();
  }catch(e){catalogoDiv.innerHTML='<div class="catalogo-empty">Erro ao carregar.</div>';}
}

function renderCatalogo(){
  catalogoDiv.innerHTML='';
  produtosAtuais.forEach((p)=>{
    const el=document.createElement('div');
    el.className='produto';
    el.innerHTML=`
      <img src="${p.imagem||'https://via.placeholder.com/400x200?text=Sem+imagem'}">
      <h3>${p.nome||'Sem nome'}</h3>
      <p>${p.descricao||''}</p>
    `;
    const btn=document.createElement('button');
    btn.textContent='Ver detalhes';
    btn.onclick=()=>abrirModalProduto(p);
    el.appendChild(btn);
    catalogoDiv.appendChild(el);
  });
}

function abrirModalProduto(produto){
  modalNome.textContent=produto.nome;
  modalDescricao.textContent=produto.descricao||'';
  modalTabela.innerHTML='';
  const tamanhos=["280ml","500ml","750ml","1L"];
  tamanhos.forEach(t=>{
    const qtd=Number(produto[t]||0);
    const disponivel=qtd>0;
    modalTabela.insertAdjacentHTML('beforeend',`
      <tr>
        <td>${t}</td>
        <td class="${disponivel?'status-ok':'status-no'}">${disponivel?`${qtd} un.`:'Indispon√≠vel'}</td>
        <td>${disponivel?`<button class="small" onclick='adicionarCarrinho("${produto.nome}","${t}")'>Adicionar</button>`:''}</td>
      </tr>`);
  });
  produtoModal.classList.add('show');
}

function adicionarCarrinho(nome,tamanho){
  const preco=PRECO_POR_TAMANHO[tamanho]||0;
  carrinho.push({nome,tamanho,preco});
  salvarCarrinho();
  produtoModal.classList.remove('show');
  showToast('Adicionado ao carrinho!');
}

function abrirCarrinho(){
  itensCarrinhoDiv.innerHTML='';
  if(!carrinho.length){itensCarrinhoDiv.innerHTML='<p class="small-muted">Carrinho vazio.</p>';totalCarrinhoP.textContent='';carrinhoModal.classList.add('show');return;}
  let total=0;
  carrinho.forEach((c,i)=>{total+=c.preco;itensCarrinhoDiv.insertAdjacentHTML('beforeend',`<p>${c.nome} (${c.tamanho}) - R$ ${c.preco} <button class="small danger" onclick="removerItem(${i})">X</button></p>`);});
  totalCarrinhoP.textContent=`Total: R$ ${total}`;
  carrinhoModal.classList.add('show');
}

function removerItem(i){carrinho.splice(i,1);salvarCarrinho();abrirCarrinho();showToast('Item removido');}
document.getElementById('limparCarrinho').onclick=()=>{if(confirm('Limpar carrinho?')){carrinho=[];salvarCarrinho();abrirCarrinho();}};
document.getElementById('finalizarPedido').onclick=async()=>{const email=emailClienteInput.value.trim();if(!email){showToast('Informe seu e-mail');return;}if(!carrinho.length){showToast('Carrinho vazio');return;}const payload=carrinho.map(c=>({nome:c.nome,tamanho:c.tamanho,preco:c.preco}));payload[0].email=email;await fetch(APPS_SCRIPT_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});showToast('Pedido enviado!');carrinho=[];salvarCarrinho();abrirCarrinho();};
document.getElementById('closeProduto').onclick=()=>produtoModal.classList.remove('show');
document.getElementById('closeCarrinho').onclick=()=>carrinhoModal.classList.remove('show');
document.getElementById('carrinhoBtn').onclick=abrirCarrinho;

renderCategorias();
salvarCarrinho();
</script>
</body>
</html>
