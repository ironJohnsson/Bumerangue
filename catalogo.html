<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>CatÃ¡logo - Bumerangue</title>

<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">

<style>
:root{--verde:#2e8b57;--fundo:#fffaf0}
body{font-family:Roboto;background:var(--fundo);margin:0}
header{background:var(--verde);color:#fff;padding:16px;text-align:center}
.catalogo{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:20px;padding:20px}
.produto{background:#fff;border-radius:10px;padding:12px;text-align:center;box-shadow:0 4px 10px rgba(0,0,0,.1)}
.produto img{width:100%;height:160px;object-fit:cover;border-radius:6px}
.product-btn{background:var(--verde);color:#fff;border:none;padding:8px 12px;border-radius:8px;cursor:pointer}
.product-btn:disabled{background:#aaa;cursor:not-allowed}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.4);justify-content:center;align-items:center}
.modal.show{display:flex}
.modal-card{background:#fff;padding:20px;border-radius:10px;width:90%;max-width:600px}
table{width:100%;border-collapse:collapse}
th,td{padding:10px;border:1px solid #ddd;text-align:center}
th{background:var(--verde);color:#fff}
.carrinho-btn{position:fixed;right:20px;bottom:20px;background:var(--verde);color:#fff;
width:60px;height:60px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:22px;cursor:pointer}
.carrinho{position:fixed;right:-360px;top:0;width:340px;height:100%;background:#fff;transition:.3s;box-shadow:-4px 0 12px rgba(0,0,0,.2)}
.carrinho.show{right:0}
</style>
</head>

<body>

<header>
  <h1>CatÃ¡logo Bumerangue</h1>
</header>

<div class="catalogo" id="catalogo"></div>

<!-- MODAL -->
<div class="modal" id="modal">
  <div class="modal-card">
    <h2 id="mNome"></h2>
    <p id="mTotal"></p>
    <table>
      <thead><tr><th>Tamanho</th><th>Qtd</th><th>AÃ§Ã£o</th></tr></thead>
      <tbody id="mTabela"></tbody>
    </table>
    <button onclick="fecharModal()">Fechar</button>
  </div>
</div>

<!-- CARRINHO -->
<div class="carrinho-btn" onclick="toggleCarrinho()">ðŸ›’</div>
<div class="carrinho" id="carrinho">
  <h3 style="padding:10px">Carrinho</h3>
  <div id="itens"></div>
  <button onclick="finalizarPedido()" style="margin:10px" class="product-btn">Finalizar Pedido</button>
</div>

<script>
const APPS_SCRIPT_URL = "https://script.google.com/macros/library/d/10rQQX5O0AFMHb9QgpXZd7MHr6BS7OlwR0fJB1KAds_qAptRc0VjbV8TU/5";
const SHEET_ID = "19c63mlSybEumd2qgRciqTOzuXtCs_5eYEa5jXTylKyQ";

let cliente = JSON.parse(localStorage.getItem("cliente"));
if(!cliente){
  cliente = {
    nome: prompt("Seu nome:"),
    whatsapp: prompt("WhatsApp:")
  };
  localStorage.setItem("cliente", JSON.stringify(cliente));
}

let produtos = [];
let carrinho = [];

async function carregar(){
  const url = `https://opensheet.elk.sh/${SHEET_ID}/Releitura dos ClÃ¡ssicos`;
  const r = await fetch(url);
  const d = await r.json();
  produtos = d.map(x=>({
    nome:x.Nome,
    imagem:x.Imagem,
    total:Number(x.Total)
  }));
  render();
}
carregar();

function render(){
  const c = document.getElementById("catalogo");
  c.innerHTML="";
  produtos.forEach((p,i)=>{
    c.innerHTML+=`
    <div class="produto">
      <img src="${p.imagem}">
      <h3>${p.nome}</h3>
      <button class="product-btn" onclick="abrirModal(${i})">Ver detalhes</button>
    </div>`;
  });
}

function abrirModal(i){
  const p=produtos[i];
  document.getElementById("mNome").innerText=p.nome;
  document.getElementById("mTotal").innerText="Total disponÃ­vel: "+p.total+" L";
  const t=document.getElementById("mTabela");
  t.innerHTML="";
  [["280ml",0.28],["500ml",0.5],["750ml",0.75],["1L",1]].forEach(v=>{
    const disabled=p.total<v[1];
    t.innerHTML+=`
    <tr>
      <td>${v[0]}</td>
      <td><input type="number" id="q${v[0]}" value="1" min="1"></td>
      <td><button ${disabled?"disabled":""} class="product-btn"
      onclick="add(${i},'${v[0]}',${v[1]})">Adicionar</button></td>
    </tr>`;
  });
  document.getElementById("modal").classList.add("show");
}

function fecharModal(){document.getElementById("modal").classList.remove("show");}

function add(i,tam,lit){
  const q=Number(document.getElementById("q"+tam).value);
  const litros=q*lit;
  if(litros>produtos[i].total)return alert("Estoque insuficiente");
  carrinho.push({produto:produtos[i].nome,tamanho:tam,qtd:q,litros});
  produtos[i].total-=litros;
  fecharModal();
  render();
}

function toggleCarrinho(){
  document.getElementById("carrinho").classList.toggle("show");
}

async function finalizarPedido(){
  if(!carrinho.length)return alert("Carrinho vazio");
  await fetch(APPS_SCRIPT_URL,{
    method:"POST",
    body:JSON.stringify({
      action:"pedido",
      cliente,
      carrinho
    })
  });
  alert("Pedido enviado!");
  carrinho=[];
  toggleCarrinho();
}
</script>
</body>
</html>
